# Документация API для системы работы с обращениями

## Установка и настройка

1. Установка зависимостей
```
npm i
```
2. Настройка базы данных

>### Перед запуском приложения необходимо:
>
>1. Создать базу данных appeals_db
>
>2. Настроить учетные данные в config/db.js
>
>3. При первом запуске приложения таблицы будут созданы автоматически (благодаря sequelize.sync())

## Базовый URL

http://localhost:3000/api/appeals (Если порт не указан в .env) либо http://localhost:9000/api/appeals (Порт 9000 указан в .env)

### Статусы обращений
* Новое - новое созданное обращение

* В работе - обращение взято в обработку

* Завершено - обращение успешно обработано

* Отменено - обращение отменено


## Endpoints

### 1. Создать обращение
**URL:** `/`

**Метод:** `POST`

**Описание:** Создает новое обращение со статусом "Новое"



```json
{
  "theme": "Тема обращения",
  "text": "Текст обращения"
}
```

#### Обязательные поля

- `theme` - строка, тема обращения

- `text` - строка, текст обращения
#### Пример ответа

```json
{
  "id": 1,
  "theme": "Проблема с доступом",
  "text": "Не могу войти в систему",
  "status": "Новое",
  "solution": null,
  "cancelReason": null,
  "createdAt": "2023-05-20T10:00:00.000Z",
  "updatedAt": "2023-05-20T10:00:00.000Z"
}
```

### 2. Взять обращение в работу

**URL:** `/:id/work`

**Метод:** `PUT`

**Описание:** Изменяет статус обращения на "В работе"

**Параметры пути:**

- `id` - ID обращения

#### Пример успешного ответа (200 OK):

```json
{
  "id": 1,
  "theme": "Проблема с доступом",
  "text": "Не могу войти в систему",
  "status": "В работе",
  "solution": null,
  "cancelReason": null,
  "createdAt": "2023-05-20T10:00:00.000Z",
  "updatedAt": "2023-05-20T10:05:00.000Z"
}
```

#### Ошибки:

- 404 Not Found - обращение с указанным ID не найдено

- 400 Bad Request - обращение уже не в статусе "Новое"

### 3. Завершить обработку обращения
**URL:** `/:id/complete`

**Метод:** `PUT`

**Описание:** Завершает обработку обращения, изменяет статус на "Завершено"

**Параметры пути:**

- `id` - ID обращения
#### Тело зароса


```json
{
  "solution": "Решение проблемы"
}
```

#### Обязательные поля

- `solution` - строка, описание решения проблемы

#### Пример ответа

```json
{
  "id": 1,
  "theme": "Проблема с доступом",
  "text": "Не могу войти в систему",
  "status": "Завершено",
  "solution": "Сброшен пароль пользователя",
  "cancelReason": null,
  "createdAt": "2023-05-20T10:00:00.000Z",
  "updatedAt": "2023-05-20T10:15:00.000Z"
}
```

#### Ошибки:

- 404 Not Found - обращение с указанным ID не найдено

- 400 Bad Request - обращение не в статусе "В работе"

### 4. Отмена обращения
**URL:** `/:id/cancel`

**Метод:** `PUT`

**Описание:** Отменяет обращение, изменяет статус на "Отменено"

**Параметры пути:**

- `id` - ID обращения
#### Тело зароса

```json
{
  "cancelReason": "Причина отмены"
}
```

#### Обязательные поля

- `cancelReason` - строка, причина отмены обращения

#### Пример ответа

```json
{
  "id": 1,
  "theme": "Проблема с доступом",
  "text": "Не могу войти в систему",
  "status": "Отменено",
  "solution": null,
  "cancelReason": "Дублирующее обращение",
  "createdAt": "2023-05-20T10:00:00.000Z",
  "updatedAt": "2023-05-20T10:10:00.000Z"
}
```

#### Ошибки:

- 404 Not Found - обращение с указанным ID не найдено

- 400 Bad Request - обращение уже завершено или отменено

### 5. Получить список обращений
**URL:** `/`

**Метод:** `GET`

**Описание:** Возвращает список обращений с возможностью фильтрации по дате

**Параметры запроса:**

- `date` (опционально) - фильтр по конкретной дате (формат: YYYY-MM-DD)

 - `startDate` и `endDate` (опционально) - фильтр по диапазону дат
#### Пример запроса

```json
GET /api/appeals?startDate=2023-05-01&endDate=2023-05-31
```

#### Пример ответа

```json
[
  {
    "id": 1,
    "theme": "Проблема с доступом",
    "text": "Не могу войти в систему",
    "status": "Завершено",
    "solution": "Сброшен пароль пользователя",
    "cancelReason": null,
    "createdAt": "2023-05-20T10:00:00.000Z",
    "updatedAt": "2023-05-20T10:15:00.000Z"
  },
  {
    "id": 2,
    "theme": "Ошибка в системе",
    "text": "При сохранении выходит ошибка",
    "status": "В работе",
    "solution": null,
    "cancelReason": null,
    "createdAt": "2023-05-21T11:00:00.000Z",
    "updatedAt": "2023-05-21T11:05:00.000Z"
  }
]
```
### 6. Массовая отмена обращений в работе
**URL:** `/cancel-all-in-progress`

**Метод:** `PUT`

**Описание:** Отменяет все обращения со статусом "В работе"

#### Тело зароса

```json
{
    "cancelReason": "Причина массовой отмены"
}
```

#### Обязательные поля

- `cancelReason` - строка, причина отмены

#### Пример ответа

```json
{
  "message": "Отменено 5 обращений"
}
```

## Пример использования

### Создание обращения
```
curl -X POST http://localhost:3000/api/appeals \
  -H "Content-Type: application/json" \
  -d '{"theme": "Тестовая тема", "text": "Тестовый текст обращения"}'
```

### Получение обращений за май 2023
```
curl "http://localhost:3000/api/appeals?startDate=2023-05-01&endDate=2023-05-31"
```

### Массовая отмена обращений в работе
```
curl -X PUT http://localhost:3000/api/appeals/cancel-all-in-progress \
  -H "Content-Type: application/json" \
  -d '{"cancelReason": "Технические работы"}'
```
